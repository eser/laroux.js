{"version":3,"sources":["laroux.web.mvvm.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","Object","defineProperty","value","web_mvvm","apps","pauseUpdate","init","element","model","constructor","String","$l","web","dom","selectById","appKey","getAttribute","on","event","update","rebind","app","modelKeys","getKeysRecursive","boundElements","eventElements","scanElements","callback","ev","elem","binding","bindStringParser","item","hasOwnProperty","charAt","substring","_length","setEvent","atts","attributes","m","name","binding1","undefined","push","target","binding2","j","chldrn","childNodes","nodeType","keys","length1","boundElement","getElement","Function","length2","style","setAttribute","text","lastBuffer","buffer","state","result","_length2","curr","trim","extendNs"],"mappings":"CAOA,QAAUA,GAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,GAAIE,GAAkB,kBAATC,UAAqBA,OAAQ,KAAIF,GAAGC,EAAE,MAAOA,GAAEF,GAAE,EAAI,IAAGI,EAAE,MAAOA,GAAEJ,GAAE,EAAI,IAAIK,GAAE,GAAIC,OAAM,uBAAuBN,EAAE,IAAK,MAAMK,GAAEE,KAAK,mBAAmBF,EAAE,GAAIG,GAAEX,EAAEG,IAAIS,WAAYb,GAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,GAAIE,GAAED,EAAEI,GAAG,GAAGL,EAAG,OAAOI,GAAEF,EAAEA,EAAEF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,MAAOD,GAAEG,GAAGS,QAAkD,IAAI,GAA1CL,GAAkB,kBAATD,UAAqBA,QAAgBH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,GAAI,OAAOD,KAAKa,GAAG,SAAST,EAAQU,EAAOJ,GAGvd,YAEAK,QAAOC,eAAeN,EAAS,cAC3BO,OAAO,GAEX,IAAIC,IACAC,QACAC,aAAa,EAEbC,KAAM,SAAcC,EAASC,GACrBD,EAAQE,cAAgBC,SACxBH,EAAUI,GAAGC,IAAIC,IAAIC,WAAWP,GAOpC,IAAIQ,GAASR,EAAQS,aAAa,KAElCR,GAAMS,GAAG,SAAUC,GACVf,EAASE,aACVF,EAASgB,OAAOJ,KAIxBZ,EAASC,KAAKW,IACVR,QAASA,EACTC,MAAOA,GAMXL,EAASiB,OAAOL,IAGpBK,OAAQ,SAAgBL,GACpB,GAAIM,GAAMlB,EAASC,KAAKW,EAExBM,GAAIC,UAAYX,GAAGY,iBAAiBF,EAAIb,OACxCa,EAAIG,iBACJH,EAAII,iBAEJtB,EAASuB,aAAaL,EAAKA,EAAId,SAC/BJ,EAASgB,OAAOJ,EAqBhB,KAAK,GAnBDY,GAAW,SAAkBC,EAAIC,GACjC,GAAIC,GAAU3B,EAAS4B,iBAAiBF,EAAKb,aAAa,YAE1D,KAAK,GAAIgB,KAAQF,GACA,OAATE,GAAkBF,EAAQG,eAAeD,KAIb,MAA5BF,EAAQE,GAAME,OAAO,GACrBb,EAAIb,MAAMwB,GAAQF,EAAQE,GAAMG,UAAU,EAAGL,EAAQE,GAAMnC,OAAS,GAC3B,UAAlCiC,EAAQE,GAAMG,UAAU,EAAG,GAClCd,EAAIb,MAAMwB,GAAQH,EAAKb,aAAac,EAAQE,GAAMG,UAAU,IACnB,UAAlCL,EAAQE,GAAMG,UAAU,EAAG,KAClCd,EAAIb,MAAMwB,GAAQH,EAAKC,EAAQE,GAAMG,UAAU,OAMlD7C,EAAI,EAAG8C,EAAUf,EAAII,cAAc5B,OAAYuC,EAAJ9C,EAAaA,IAC7DqB,GAAGC,IAAIC,IAAIwB,SAAShB,EAAII,cAAcnC,GAAGiB,QAASc,EAAII,cAAcnC,GAAGwC,QAAQ,MAAOH,IAI9FD,aAAc,SAAsBL,EAAKd,GACrC,IAAK,GAAIjB,GAAI,EAAGgD,EAAO/B,EAAQgC,WAAYC,EAAIF,EAAKzC,OAAY2C,EAAJlD,EAAOA,IAC/D,GAAqB,YAAjBgD,EAAKhD,GAAGmD,KAAoB,CAC5B,GAAIC,GAAWvC,EAAS4B,iBAAiBO,EAAKhD,GAAGY,MAEjD,KAAK,GAAI8B,KAAQU,GACRA,EAAST,eAAeD,KAIaW,SAAtCtB,EAAIG,cAAckB,EAASV,MAC3BX,EAAIG,cAAckB,EAASV,QAG/BX,EAAIG,cAAckB,EAASV,IAAOY,MAC9BrC,QAASA,EACTsC,OAAQb,SAGb,IAAqB,aAAjBM,EAAKhD,GAAGmD,KAAqB,CACpC,GAAIK,GAAW3C,EAAS4B,iBAAiBO,EAAKhD,GAAGY,MAEjDmB,GAAII,cAAcmB,MACdrC,QAASA,EACTuB,QAASgB,IAKrB,IAAK,GAAIC,GAAI,EAAGC,EAASzC,EAAQ0C,WAAYlE,EAAIiE,EAAOnD,OAAYd,EAAJgE,EAAOA,IACxC,IAAvBC,EAAOD,GAAGG,UACV/C,EAASuB,aAAaL,EAAK2B,EAAOD,KAK9C5B,OAAQ,SAAgBJ,EAAQoC,GAC5B,GAAI9B,GAAMlB,EAASC,KAAKW,EAEJ,oBAAToC,KACPA,EAAO9B,EAAIC,UAGf,KAAK,GAAIhC,GAAI,EAAG8D,EAAUD,EAAKtD,OAAYuD,EAAJ9D,EAAaA,IAChD,GAAM6D,EAAK7D,IAAM+B,GAAIG,cAArB,CAIA,GAAI6B,GAAehC,EAAIG,cAAc2B,EAAK7D,IACtCY,EAAQS,GAAG2C,WAAWjC,EAAIb,MAAO2C,EAAK7D,GAEtCY,aAAiBqD,YACjBrD,EAAQA,EAAMN,KAAKyB,EAAIb,OAG3B,KAAK,GAAIuC,GAAI,EAAGS,EAAUH,EAAaxD,OAAY2D,EAAJT,EAAaA,IACT,WAA3CM,EAAaN,GAAGF,OAAOV,UAAU,EAAG,GACpCkB,EAAaN,GAAGxC,QAAQkD,MAAMJ,EAAaN,GAAGF,OAAOV,UAAU,IAAMjC,EACnB,UAA3CmD,EAAaN,GAAGF,OAAOV,UAAU,EAAG,GAE3CkB,EAAaN,GAAGxC,QAAQmD,aAAaL,EAAaN,GAAGF,OAAOV,UAAU,GAAIjC,GACxB,UAA3CmD,EAAaN,GAAGF,OAAOV,UAAU,EAAG,KAE3CkB,EAAaN,GAAGxC,QAAQ8C,EAAaN,GAAGF,OAAOV,UAAU,IAAMjC,KAM/E6B,iBAAkB,SAA0B4B,GAMxC,IAAK,GALDC,GAAa,KACbC,EAAS,GACTC,EAAQ,EACRC,KAEKzE,EAAI,EAAG0E,EAAWL,EAAK9D,OAAYmE,EAAJ1E,EAAcA,IAAK,CACvD,GAAI2E,GAAON,EAAKzB,OAAO5C,EAET,KAAVwE,GACa,MAATG,EAQK,MAATA,EAOJJ,GAAUI,GANNH,EAAQ,EACRC,EAAOH,GAAcC,EAAOK,OAC5BL,EAAS,KAVLC,EAAQ,EACRF,EAAaC,EAAOK,OACpBL,EAAS,IAmBrB,MAJIA,GAAOhE,OAAS,IAChBkE,EAAOH,GAAcC,EAAOK,QAGzBH,GAIfpD,IAAGwD,SAAS,WAAYhE,GAExBR,EAAQ,WAAaQ,EACrBJ,EAAOJ,QAAUA,EAAQ,qBACd","file":"build/dist/laroux.web.mvvm/laroux.web.mvvm.min.js","sourcesContent":["/**\n * laroux.js - A jquery substitute for modern browsers (laroux.web.mvvm bundle)\n *\n * @version v2.2.0\n * @link https://eserozvataf.github.io/laroux.js\n * @license Apache-2.0\n */\n(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*jslint node: true */\n/*global $l */\n'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n    value: true\n});\nvar web_mvvm = {\n    apps: {},\n    pauseUpdate: false,\n\n    init: function init(element, model) {\n        if (element.constructor === String) {\n            element = $l.web.dom.selectById(element);\n        }\n\n        // if (model.constructor !== types.Observable) {\n        //     model = new types.Observable(model);\n        // }\n\n        var appKey = element.getAttribute('id');\n\n        model.on(function (event) {\n            if (!web_mvvm.pauseUpdate) {\n                web_mvvm.update(appKey); // , [event.key]\n            }\n        });\n\n        web_mvvm.apps[appKey] = {\n            element: element,\n            model: model // ,\n            // modelKeys: null,\n            // boundElements: null,\n            // eventElements: null\n        };\n\n        web_mvvm.rebind(appKey);\n    },\n\n    rebind: function rebind(appKey) {\n        var app = web_mvvm.apps[appKey];\n        /*jslint nomen: true */\n        app.modelKeys = $l.getKeysRecursive(app.model); // FIXME: works only for $l.types.Observable\n        app.boundElements = {};\n        app.eventElements = [];\n\n        web_mvvm.scanElements(app, app.element);\n        web_mvvm.update(appKey);\n\n        var callback = function callback(ev, elem) {\n            var binding = web_mvvm.bindStringParser(elem.getAttribute('lr-event'));\n            // web_mvvm.pauseUpdate = true;\n            for (var item in binding) {\n                if (item === null || !binding.hasOwnProperty(item)) {\n                    continue;\n                }\n\n                if (binding[item].charAt(0) === '\\'') {\n                    app.model[item] = binding[item].substring(1, binding[item].length - 1);\n                } else if (binding[item].substring(0, 5) === 'attr.') {\n                    app.model[item] = elem.getAttribute(binding[item].substring(5));\n                } else if (binding[item].substring(0, 5) === 'prop.') {\n                    app.model[item] = elem[binding[item].substring(5)];\n                }\n            }\n            // web_mvvm.pauseUpdate = false;\n        };\n\n        for (var i = 0, _length = app.eventElements.length; i < _length; i++) {\n            $l.web.dom.setEvent(app.eventElements[i].element, app.eventElements[i].binding[null], callback);\n        }\n    },\n\n    scanElements: function scanElements(app, element) {\n        for (var i = 0, atts = element.attributes, m = atts.length; i < m; i++) {\n            if (atts[i].name === 'lr-bind') {\n                var binding1 = web_mvvm.bindStringParser(atts[i].value);\n\n                for (var item in binding1) {\n                    if (!binding1.hasOwnProperty(item)) {\n                        continue;\n                    }\n\n                    if (app.boundElements[binding1[item]] === undefined) {\n                        app.boundElements[binding1[item]] = [];\n                    }\n\n                    app.boundElements[binding1[item]].push({\n                        element: element,\n                        target: item\n                    });\n                }\n            } else if (atts[i].name === 'lr-event') {\n                var binding2 = web_mvvm.bindStringParser(atts[i].value);\n\n                app.eventElements.push({\n                    element: element,\n                    binding: binding2\n                });\n            }\n        }\n\n        for (var j = 0, chldrn = element.childNodes, n = chldrn.length; j < n; j++) {\n            if (chldrn[j].nodeType === 1) {\n                web_mvvm.scanElements(app, chldrn[j]);\n            }\n        }\n    },\n\n    update: function update(appKey, keys) {\n        var app = web_mvvm.apps[appKey];\n\n        if (typeof keys === 'undefined') {\n            keys = app.modelKeys;\n        }\n\n        for (var i = 0, length1 = keys.length; i < length1; i++) {\n            if (!(keys[i] in app.boundElements)) {\n                continue;\n            }\n\n            var boundElement = app.boundElements[keys[i]],\n                value = $l.getElement(app.model, keys[i]);\n\n            if (value instanceof Function) {\n                value = value.call(app.model);\n            }\n\n            for (var j = 0, length2 = boundElement.length; j < length2; j++) {\n                if (boundElement[j].target.substring(0, 6) === 'style.') {\n                    boundElement[j].element.style[boundElement[j].target.substring(6)] = value;\n                } else if (boundElement[j].target.substring(0, 5) === 'attr.') {\n                    // FIXME removeAttribute on null value?\n                    boundElement[j].element.setAttribute(boundElement[j].target.substring(5), value);\n                } else if (boundElement[j].target.substring(0, 5) === 'prop.') {\n                    // FIXME removeAttribute on null value?\n                    boundElement[j].element[boundElement[j].target.substring(5)] = value;\n                }\n            }\n        }\n    },\n\n    bindStringParser: function bindStringParser(text) {\n        var lastBuffer = null,\n            buffer = '',\n            state = 0,\n            result = {};\n\n        for (var i = 0, _length2 = text.length; i < _length2; i++) {\n            var curr = text.charAt(i);\n\n            if (state === 0) {\n                if (curr === ':') {\n                    state = 1;\n                    lastBuffer = buffer.trim();\n                    buffer = '';\n                    continue;\n                }\n            }\n\n            if (curr === ',') {\n                state = 0;\n                result[lastBuffer] = buffer.trim();\n                buffer = '';\n                continue;\n            }\n\n            buffer += curr;\n        }\n\n        if (buffer.length > 0) {\n            result[lastBuffer] = buffer.trim();\n        }\n\n        return result;\n    }\n};\n\n$l.extendNs('web.mvvm', web_mvvm);\n\nexports['default'] = web_mvvm;\nmodule.exports = exports['default'];\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}